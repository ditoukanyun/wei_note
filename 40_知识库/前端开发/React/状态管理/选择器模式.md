---
title: "选择器模式"
date: 2026-02-11
tags: [前端架构, 性能优化, 概念]
category: 前端开发
status: active
---

# 选择器模式 (Selector Pattern)

## 定义

选择器模式是一种从状态容器中**精确提取所需数据**的技术，通过比较前后返回值来决定是否触发订阅者更新。

## 工作原理

```
组件订阅 → 选择器执行 → 比较返回值 
                          ↓
                    相同 → 不触发重渲染
                    不同 → 触发重渲染
```

## 在 Zustand 中的应用

```typescript
// 基础选择器
const count = useStore((state) => state.count)

// 派生选择器
const doubleCount = useStore((state) => state.count * 2)

// 多值选择器 + shallow
const { count, name } = useStore(
  (state) => ({ count: state.count, name: state.name }),
  shallow
)
```

## 优势

- **性能优化**：避免不必要重渲染
- **关注点分离**：组件只获取需要的数据
- **可测试性**：选择器是纯函数

## 浅比较 (Shallow Comparison)

检查对象的**第一层属性**是否严格相等（===）。

```typescript
// 使用 shallow 避免对象引用问题
const data = useStore(
  (state) => ({ a: state.a, b: state.b }),
  shallow
)
```

## 相关概念

- [[Zustand]]
- [[中间件模式]]
- [[状态持久化]]
- [[不可变性]]
- [[React 渲染优化]]
